
// const { createClient } = require('@libsql/client');

// /* ===========================
//    Validation
// =========================== */
// if (!process.env.TURSO_DB_URL || !process.env.TURSO_DB_AUTH_TOKEN) {
//   throw new Error(
//     'โ Missing TURSO_DB_URL or TURSO_DB_AUTH_TOKEN in backend/.env'
//   );
// }

// /* ===========================
//    Turso Client
// =========================== */
// const client = createClient({
//   url: process.env.TURSO_DB_URL,
//   authToken: process.env.TURSO_DB_AUTH_TOKEN,
// });

// let logged = false;
// function logOnce() {
//   if (!logged) {
//     console.log('โ Connected to Turso (remote SQLite via libSQL)');
//     logged = true;
//   }
// }

// /* ===========================
//    Query Helpers
// =========================== */
// async function executeQuery(sql, params = []) {
//   logOnce();
//   const result = await client.execute({
//     sql,
//     args: params,
//   });
//   return result.rows || [];
// }

// async function executeGet(sql, params = []) {
//   logOnce();
//   const result = await client.execute({
//     sql,
//     args: params,
//   });
//   return result.rows?.[0] ?? null;
// }

// /* ===========================
//    Surah Names (ููุง ูุงู ูุชููุนูุง)
// =========================== */
// const getSurahName = (surahNo) => {
//   const surahNames = {
//     1: 'ุงููุงุชุญุฉ', 2: 'ุงูุจูุฑุฉ', 3: 'ุขู ุนูุฑุงู', 4: 'ุงููุณุงุก', 5: 'ุงููุงุฆุฏุฉ',
//     6: 'ุงูุฃูุนุงู', 7: 'ุงูุฃุนุฑุงู', 8: 'ุงูุฃููุงู', 9: 'ุงูุชูุจุฉ', 10: 'ูููุณ',
//     11: 'ููุฏ', 12: 'ููุณู', 13: 'ุงูุฑุนุฏ', 14: 'ุฅุจุฑุงููู', 15: 'ุงูุญุฌุฑ',
//     16: 'ุงููุญู', 17: 'ุงูุฅุณุฑุงุก', 18: 'ุงูููู', 19: 'ูุฑูู', 20: 'ุทู',
//     21: 'ุงูุฃูุจูุงุก', 22: 'ุงูุญุฌ', 23: 'ุงููุคูููู', 24: 'ุงูููุฑ', 25: 'ุงููุฑูุงู',
//     26: 'ุงูุดุนุฑุงุก', 27: 'ุงูููู', 28: 'ุงููุตุต', 29: 'ุงูุนููุจูุช', 30: 'ุงูุฑูู',
//     31: 'ูููุงู', 32: 'ุงูุณุฌุฏุฉ', 33: 'ุงูุฃุญุฒุงุจ', 34: 'ุณุจุฃ', 35: 'ูุงุทุฑ',
//     36: 'ูุณ', 37: 'ุงูุตุงูุงุช', 38: 'ุต', 39: 'ุงูุฒูุฑ', 40: 'ุบุงูุฑ',
//     41: 'ูุตูุช', 42: 'ุงูุดูุฑู', 43: 'ุงูุฒุฎุฑู', 44: 'ุงูุฏุฎุงู', 45: 'ุงูุฌุงุซูุฉ',
//     46: 'ุงูุฃุญูุงู', 47: 'ูุญูุฏ', 48: 'ุงููุชุญ', 49: 'ุงูุญุฌุฑุงุช', 50: 'ู',
//     51: 'ุงูุฐุงุฑูุงุช', 52: 'ุงูุทูุฑ', 53: 'ุงููุฌู', 54: 'ุงูููุฑ', 55: 'ุงูุฑุญูู',
//     56: 'ุงููุงูุนุฉ', 57: 'ุงูุญุฏูุฏ', 58: 'ุงููุฌุงุฏูุฉ', 59: 'ุงูุญุดุฑ', 60: 'ุงูููุชุญูุฉ',
//     61: 'ุงูุตู', 62: 'ุงูุฌูุนุฉ', 63: 'ุงูููุงูููู', 64: 'ุงูุชุบุงุจู', 65: 'ุงูุทูุงู',
//     66: 'ุงูุชุญุฑูู', 67: 'ุงูููู', 68: 'ุงูููู', 69: 'ุงูุญุงูุฉ', 70: 'ุงููุนุงุฑุฌ',
//     71: 'ููุญ', 72: 'ุงูุฌู', 73: 'ุงููุฒูู', 74: 'ุงููุฏุซุฑ', 75: 'ุงูููุงูุฉ',
//     76: 'ุงูุฅูุณุงู', 77: 'ุงููุฑุณูุงุช', 78: 'ุงููุจุฃ', 79: 'ุงููุงุฒุนุงุช', 80: 'ุนุจุณ',
//     81: 'ุงูุชูููุฑ', 82: 'ุงูุฅููุทุงุฑ', 83: 'ุงููุทูููู', 84: 'ุงูุงูุดูุงู', 85: 'ุงูุจุฑูุฌ',
//     86: 'ุงูุทุงุฑู', 87: 'ุงูุฃุนูู', 88: 'ุงูุบุงุดูุฉ', 89: 'ุงููุฌุฑ', 90: 'ุงูุจูุฏ',
//     91: 'ุงูุดูุณ', 92: 'ุงูููู', 93: 'ุงูุถุญู', 94: 'ุงูุดุฑุญ', 95: 'ุงูุชูู',
//     96: 'ุงูุนูู', 97: 'ุงููุฏุฑ', 98: 'ุงูุจููุฉ', 99: 'ุงูุฒูุฒูุฉ', 100: 'ุงูุนุงุฏูุงุช',
//     101: 'ุงููุงุฑุนุฉ', 102: 'ุงูุชูุงุซุฑ', 103: 'ุงูุนุตุฑ', 104: 'ุงูููุฒุฉ', 105: 'ุงูููู',
//     106: 'ูุฑูุด', 107: 'ุงููุงุนูู', 108: 'ุงูููุซุฑ', 109: 'ุงููุงูุฑูู', 110: 'ุงููุตุฑ',
//     111: 'ุงููุณุฏ', 112: 'ุงูุฅุฎูุงุต', 113: 'ุงูููู', 114: 'ุงููุงุณ'
//   };

//   return surahNames[surahNo] || `ุณูุฑุฉ ${surahNo}`;
// };

// /* ===========================
//    Public API (ูุทุงุจูุฉ 100%)
// =========================== */
// module.exports = {
//   executeQuery,
//   executeGet,
//   getSurahName,
// };
const { createClient } = require('@libsql/client');
const path = require('path');

/* ===========================
   Database Configuration
=========================== */
// ุชุญุฏูุฏ ูุณุงุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ ุชููุงุฆูุงู
// ูุญู ูู: backend/src/config
// ุงูุฏุงุชุง ูู: backend/data/quran.db
const localDbPath = path.join(process.cwd(), 'backend', 'database', 'quran_roots_dual_v2.sqlite');

const config = {
  url: process.env.TURSO_DB_URL || `file:${localDbPath}`,
  authToken: process.env.TURSO_DB_AUTH_TOKEN,
};

/* ===========================
   Client Initialization
=========================== */
const client = createClient(config);

let logged = false;
function logOnce() {
  if (!logged) {
    const mode = config.url.startsWith('file:') ? '๐ Local SQLite (Production Safe)' : 'โ๏ธ Remote Turso';
    console.log(`โ Database Connected: ${mode}`);
    console.log(`๐ Path used: ${localDbPath}`); // ุณูุธูุฑ ูุฐุง ูู ููุฌ Vercel ููุชุฃูุฏ
    logged = true;
  }
}

/* ===========================
   Query Helpers
=========================== */
async function executeQuery(sql, params = []) {
  logOnce();
  try {
    const result = await client.execute({
      sql,
      args: params,
    });
    return result.rows || [];
  } catch (error) {
    console.error('โ Database Query Error:', error.message);
    throw error;
  }
}

async function executeGet(sql, params = []) {
  logOnce();
  try {
    const result = await client.execute({
      sql,
      args: params,
    });
    return result.rows?.[0] ?? null;
  } catch (error) {
    console.error('โ Database Get Error:', error.message);
    throw error;
  }
}

/* ===========================
   Surah Names
=========================== */
const getSurahName = (surahNo) => {
  const surahNames = {
    1: 'ุงููุงุชุญุฉ', 2: 'ุงูุจูุฑุฉ', 3: 'ุขู ุนูุฑุงู', 4: 'ุงููุณุงุก', 5: 'ุงููุงุฆุฏุฉ',
    6: 'ุงูุฃูุนุงู', 7: 'ุงูุฃุนุฑุงู', 8: 'ุงูุฃููุงู', 9: 'ุงูุชูุจุฉ', 10: 'ูููุณ',
    11: 'ููุฏ', 12: 'ููุณู', 13: 'ุงูุฑุนุฏ', 14: 'ุฅุจุฑุงููู', 15: 'ุงูุญุฌุฑ',
    16: 'ุงููุญู', 17: 'ุงูุฅุณุฑุงุก', 18: 'ุงูููู', 19: 'ูุฑูู', 20: 'ุทู',
    21: 'ุงูุฃูุจูุงุก', 22: 'ุงูุญุฌ', 23: 'ุงููุคูููู', 24: 'ุงูููุฑ', 25: 'ุงููุฑูุงู',
    26: 'ุงูุดุนุฑุงุก', 27: 'ุงูููู', 28: 'ุงููุตุต', 29: 'ุงูุนููุจูุช', 30: 'ุงูุฑูู',
    31: 'ูููุงู', 32: 'ุงูุณุฌุฏุฉ', 33: 'ุงูุฃุญุฒุงุจ', 34: 'ุณุจุฃ', 35: 'ูุงุทุฑ',
    36: 'ูุณ', 37: 'ุงูุตุงูุงุช', 38: 'ุต', 39: 'ุงูุฒูุฑ', 40: 'ุบุงูุฑ',
    41: 'ูุตูุช', 42: 'ุงูุดูุฑู', 43: 'ุงูุฒุฎุฑู', 44: 'ุงูุฏุฎุงู', 45: 'ุงูุฌุงุซูุฉ',
    46: 'ุงูุฃุญูุงู', 47: 'ูุญูุฏ', 48: 'ุงููุชุญ', 49: 'ุงูุญุฌุฑุงุช', 50: 'ู',
    51: 'ุงูุฐุงุฑูุงุช', 52: 'ุงูุทูุฑ', 53: 'ุงููุฌู', 54: 'ุงูููุฑ', 55: 'ุงูุฑุญูู',
    56: 'ุงููุงูุนุฉ', 57: 'ุงูุญุฏูุฏ', 58: 'ุงููุฌุงุฏูุฉ', 59: 'ุงูุญุดุฑ', 60: 'ุงูููุชุญูุฉ',
    61: 'ุงูุตู', 62: 'ุงูุฌูุนุฉ', 63: 'ุงูููุงูููู', 64: 'ุงูุชุบุงุจู', 65: 'ุงูุทูุงู',
    66: 'ุงูุชุญุฑูู', 67: 'ุงูููู', 68: 'ุงูููู', 69: 'ุงูุญุงูุฉ', 70: 'ุงููุนุงุฑุฌ',
    71: 'ููุญ', 72: 'ุงูุฌู', 73: 'ุงููุฒูู', 74: 'ุงููุฏุซุฑ', 75: 'ุงูููุงูุฉ',
    76: 'ุงูุฅูุณุงู', 77: 'ุงููุฑุณูุงุช', 78: 'ุงููุจุฃ', 79: 'ุงููุงุฒุนุงุช', 80: 'ุนุจุณ',
    81: 'ุงูุชูููุฑ', 82: 'ุงูุฅููุทุงุฑ', 83: 'ุงููุทูููู', 84: 'ุงูุงูุดูุงู', 85: 'ุงูุจุฑูุฌ',
    86: 'ุงูุทุงุฑู', 87: 'ุงูุฃุนูู', 88: 'ุงูุบุงุดูุฉ', 89: 'ุงููุฌุฑ', 90: 'ุงูุจูุฏ',
    91: 'ุงูุดูุณ', 92: 'ุงูููู', 93: 'ุงูุถุญู', 94: 'ุงูุดุฑุญ', 95: 'ุงูุชูู',
    96: 'ุงูุนูู', 97: 'ุงููุฏุฑ', 98: 'ุงูุจููุฉ', 99: 'ุงูุฒูุฒูุฉ', 100: 'ุงูุนุงุฏูุงุช',
    101: 'ุงููุงุฑุนุฉ', 102: 'ุงูุชูุงุซุฑ', 103: 'ุงูุนุตุฑ', 104: 'ุงูููุฒุฉ', 105: 'ุงูููู',
    106: 'ูุฑูุด', 107: 'ุงููุงุนูู', 108: 'ุงูููุซุฑ', 109: 'ุงููุงูุฑูู', 110: 'ุงููุตุฑ',
    111: 'ุงููุณุฏ', 112: 'ุงูุฅุฎูุงุต', 113: 'ุงูููู', 114: 'ุงููุงุณ'
  };

  return surahNames[surahNo] || `ุณูุฑุฉ ${surahNo}`;
};

/* ===========================
   Public API
=========================== */
module.exports = {
  executeQuery,
  executeGet,
  getSurahName,
};